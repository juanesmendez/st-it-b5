-- REQUERIMIENTO 11

-- SE CREA LA SIGUIENTE VISTA:

CREATE VIEW PRODUCTOSVENDIDOSXSEMANA AS(
    SELECT TO_NUMBER(to_char(to_date(FACTURA.FECHA,'DD/MM/YYYY'),'WW')) AS SEMANA, FACTURAPRODUCTO.IDPRODUCTO, SUM(FACTURAPRODUCTO.UNIVENDIDAS) AS SUMA
    FROM FACTURA
    INNER JOIN FACTURAPRODUCTO ON FACTURA.ID = FACTURAPRODUCTO.IDFACTURA
    GROUP BY TO_NUMBER(to_char(to_date(FACTURA.FECHA,'DD/MM/YYYY'),'WW')),FACTURAPRODUCTO.IDPRODUCTO
);


-- PRODUCTO MAS VENDIDO EN CADA SEMANA DEL AÑO
SELECT PRODUCTOSVENDIDOSXSEMANA.SEMANA, PRODUCTOSVENDIDOSXSEMANA.IDPRODUCTO, PRODUCTO.NOMBRE, SUBQUERY.MAXIMO
FROM
(SELECT SEMANA, MAX(SUMA) AS MAXIMO
FROM PRODUCTOSVENDIDOSXSEMANA
GROUP BY SEMANA) SUBQUERY
INNER JOIN PRODUCTOSVENDIDOSXSEMANA ON PRODUCTOSVENDIDOSXSEMANA.SUMA = SUBQUERY.MAXIMO AND PRODUCTOSVENDIDOSXSEMANA.SEMANA = SUBQUERY.SEMANA
INNER JOIN PRODUCTO ON PRODUCTO.ID = PRODUCTOSVENDIDOSXSEMANA.IDPRODUCTO
ORDER BY PRODUCTOSVENDIDOSXSEMANA.SEMANA;

-- PRODUCTO MENOS VENDIDO EN CADA SEMANA DEL AÑO
SELECT PRODUCTOSVENDIDOSXSEMANA.SEMANA, PRODUCTOSVENDIDOSXSEMANA.IDPRODUCTO, PRODUCTO.NOMBRE, SUBQUERY.MINIMO
FROM
(SELECT SEMANA, MIN(SUMA) AS MINIMO
FROM PRODUCTOSVENDIDOSXSEMANA
GROUP BY SEMANA) SUBQUERY
INNER JOIN PRODUCTOSVENDIDOSXSEMANA ON PRODUCTOSVENDIDOSXSEMANA.SUMA = SUBQUERY.MINIMO AND PRODUCTOSVENDIDOSXSEMANA.SEMANA = SUBQUERY.SEMANA
INNER JOIN PRODUCTO ON PRODUCTO.ID = PRODUCTOSVENDIDOSXSEMANA.IDPRODUCTO
ORDER BY PRODUCTOSVENDIDOSXSEMANA.SEMANA;