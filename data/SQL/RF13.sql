--REQUERIMIENTO FUNCIONAL 13

-- CLIENTES QUE HICIERON AL MENOS UNA COMPRA POR MES
SELECT CLIENTE.ID, CLIENTE.NOMBRE, EXTRACT(MONTH FROM FACTURA.FECHA) AS MES, COUNT(DISTINCT FACTURA.ID) AS COMPRAS
FROM CLIENTE
INNER JOIN FACTURA ON CLIENTE.ID = FACTURA.IDCLIENTE
GROUP BY CLIENTE.ID, CLIENTE.NOMBRE,EXTRACT(MONTH FROM FACTURA.FECHA)
ORDER BY COUNT(DISTINCT FACTURA.ID) DESC,CLIENTE.NOMBRE ASC;

-- CLIENTES QUE HICIERON AL MENOS UNA COMPRA QUE CONTENIA UN PRODUCTO DE UN COSTO MAYOR A 100000
SELECT DISTINCT CLIENTE.ID, CLIENTE.NOMBRE
FROM CLIENTE
INNER JOIN FACTURA ON CLIENTE.ID = FACTURA.IDCLIENTE
INNER JOIN FACTURAPRODUCTO ON FACTURA.ID = FACTURAPRODUCTO.IDFACTURA
INNER JOIN VENDE ON VENDE.IDPRODUCTO = FACTURAPRODUCTO.IDPRODUCTO
WHERE VENDE.PRECIO > 100000;

-- CLIENTES QUE HAN REALIZADO UNA COMPRA DE UN PRODUCTO DE ELECTRONICS Y TOOLS
SELECT DISTINCT CLIENTE.ID, CLIENTE.NOMBRE
FROM CLIENTE
INNER JOIN FACTURA ON CLIENTE.ID = FACTURA.IDCLIENTE
INNER JOIN FACTURAPRODUCTO ON FACTURA.ID = FACTURAPRODUCTO.IDFACTURA
INNER JOIN PRODUCTO ON PRODUCTO.ID = FACTURAPRODUCTO.IDPRODUCTO
INNER JOIN TIPOPRODUCTO ON TIPOPRODUCTO.ID = PRODUCTO.IDTIPOPRODUCTO
WHERE TIPOPRODUCTO.NOMBRE = 'Electronics' or TIPOPRODUCTO.NOMBRE = 'Tools';